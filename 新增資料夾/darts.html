<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æŠ€è¡“æµå°„é£›é¢ PRO</title>
<style>
body {
    margin: 0;
    background: #111;
    color: white;
    text-align: center;
    font-family: Arial;
}
canvas {
    background: #222;
    display: block;
    margin: auto;
    cursor: crosshair;
}
#info {
    padding: 8px;
}
.bar {
    width: 200px;
    height: 18px;
    border: 2px solid white;
    margin: auto;
}
.fill {
    height: 100%;
    background: lime;
}
</style>
</head>
<body>

<h2>ğŸ¯ æŠ€è¡“æµå°„é£›é¢ PRO</h2>
<div id="info">
åˆ†æ•¸ <span id="score">0</span> |
Combo <span id="combo">1</span>x |
é¢¨ <span id="wind"></span>
</div>
<div class="bar"><div class="fill" id="power"></div></div>

<canvas id="game" width="500" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let score = 0;
let combo = 1;

// è“„åŠ›
let power = 0, dir = 1, charging = false;

// é¢¨
let windX = 0, windY = 0;

// é¶
const target = {
    x: 250,
    y: 150,
    r: 80,
    angle: 0,
    speed: 0.01,
    moveDir: 1
};

// é£›é¢ç´€éŒ„
const darts = [];

function newWind() {
    windX = Math.floor(Math.random() * 5 - 2);
windY = Math.floor(Math.random() * 3 - 1);

    document.getElementById("wind").innerText =
        `${windX > 0 ? "â†’" : windX < 0 ? "â†" : "â€¢"} ${windY > 0 ? "â†“" : windY < 0 ? "â†‘" : ""}`;
}
newWind();

canvas.addEventListener("mousedown", () => charging = true);
canvas.addEventListener("mouseup", shoot);

function shoot() {
    if (!charging) return;
    charging = false;

    let hitX = 250 + windX * power;
    let hitY = 500 - power * 3 + windY * power;

    const dx = hitX - target.x;
    const dy = hitY - target.y;
    const dist = Math.hypot(dx, dy);

    let add = 0;
    if (dist < 30) add = 300;
else if (dist < 55) add = 100;
else if (dist < 90) add = 50;


    if (add > 0) {
        score += add * combo;
        combo++;
        // è¨˜éŒ„é£›é¢ï¼ˆç›¸å°è§’åº¦ï¼‰
        darts.push({
            angle: Math.atan2(dy, dx) - target.angle,
            dist: dist
        });
    } else {
        combo = 1;
    }

    document.getElementById("score").innerText = score;
    document.getElementById("combo").innerText = combo;
    newWind();
}

function updatePower() {
    if (charging) {
        power += dir * 2;
        if (power >= 100 || power <= 0) dir *= -1;
        document.getElementById("power").style.width = power * 2 + "px";
    }
}

function updateTarget() {
    target.angle += target.speed;
    target.x += target.moveDir * 1.2;
    if (target.x > 320 || target.x < 180) target.moveDir *= -1;
}

function drawTarget() {
    ctx.save();
    ctx.translate(target.x, target.y);
    ctx.rotate(target.angle);

    ctx.beginPath();
    ctx.arc(0, 0, 80, 0, Math.PI * 2);
    ctx.fillStyle = "#555";
    ctx.fill();

    ctx.beginPath();
    ctx.arc(0, 0, 45, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();

    ctx.beginPath();
    ctx.arc(0, 0, 20, 0, Math.PI * 2);
    ctx.fillStyle = "gold";
    ctx.fill();

    ctx.restore();
}

function drawDarts() {
    ctx.save();
    ctx.translate(target.x, target.y);
    ctx.rotate(target.angle);

    darts.forEach(d => {
        ctx.beginPath();
        ctx.moveTo(
            Math.cos(d.angle) * d.dist,
            Math.sin(d.angle) * d.dist
        );
        ctx.lineTo(
            Math.cos(d.angle) * (d.dist + 15),
            Math.sin(d.angle) * (d.dist + 15)
        );
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.stroke();
    });

    ctx.restore();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    updatePower();
    updateTarget();
    drawTarget();
    drawDarts();
    requestAnimationFrame(draw);
    if (charging) {
    ctx.beginPath();
    ctx.arc(250 + windX * power, 500 - power * 3, 8, 0, Math.PI * 2);
    ctx.fillStyle = "rgba(0,255,0,0.5)";
    ctx.fill();
}

}

draw();
</script>

</body>
</html>
