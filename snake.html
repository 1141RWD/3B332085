<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ ç¶“å…¸è²ªé£Ÿè›‡ï¼šé€²åŒ–ç‰ˆ</title>
    <style>
        :root {
            --primary-green: #2ecc71;
            --dark-bg: #050510;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; background: var(--dark-bg); color: white;
            text-align: center; font-family: 'Segoe UI', sans-serif;
            overflow: hidden; touch-action: none;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; /* å›ºå®šé«˜åº¦ç‚ºè¢å¹•é«˜åº¦ */
        }

        /* å¤§å»³æŒ‰éˆ• */
        #home-btn-container {
            position: fixed; top: 10px; left: 10px; z-index: 9999;
            display: flex; align-items: center; gap: 5px;
            padding: 5px 12px; background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px); border: 1px solid rgba(0, 242, 254, 0.5);
            border-radius: 50px; color: #00f2fe; cursor: pointer; font-size: 13px;
        }

        h1 { margin: 10px 0 0; font-size: 1.2rem; color: var(--primary-green); }
        #score { font-size: 1rem; margin: 5px 0; font-weight: bold; }

        /* ç•«å¸ƒå®¹å™¨å„ªåŒ– */
        #canvas-container {
            position: relative; 
            width: 85vw; height: 85vw; /* æ ¹æ“šå¯¬åº¦æ±ºå®šé«˜åº¦ï¼Œä¿æŒæ­£æ–¹å½¢ */
            max-width: 320px; max-height: 320px;
            border: 3px solid #334155; border-radius: 10px; 
            background: #000; box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        canvas { width: 100%; height: 100%; display: block; }

        /* è™›æ“¬æ–æ¡¿å„ªåŒ–ï¼šç¸®å°å°ºå¯¸é˜²æ­¢æ¨æ“ ç•«é¢ */
        .controls {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 8px; width: 150px; margin: 15px auto;
        }
        .btn {
            width: 45px; height: 45px; background: rgba(255,255,255,0.1);
            border: 2px solid var(--primary-green); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: var(--primary-green); cursor: pointer;
            user-select: none; transition: 0.1s;
        }
        .btn:active { background: var(--primary-green); color: black; transform: scale(0.9); }
        .btn.up { grid-column: 2; }
        .btn.left { grid-column: 1; }
        .btn.right { grid-column: 3; }
        .btn.down { grid-column: 2; }

        .menu { margin-top: auto; padding-bottom: 20px; }
        button.reset {
            padding: 8px 20px; font-size: 0.9rem; border-radius: 20px;
            border: none; background: #e74c3c; color: white; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="home-btn-container" onclick="window.location.href='index.html'">
        <svg viewBox="0 0 24 24" width="18" height="18">
            <path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span>å¤§å»³</span>
    </div>

    <h1>ğŸ SNAKE</h1>
    <div id="score">SCORE: 0</div>

    <div id="canvas-container">
        <canvas id="game" width="400" height="400"></canvas>
    </div>

    <div class="controls">
        <div class="btn up" onclick="setDir('UP')">â–²</div>
        <div class="btn left" onclick="setDir('LEFT')">â—€</div>
        <div class="btn right" onclick="setDir('RIGHT')">â–¶</div>
        <div class="btn down" onclick="setDir('DOWN')">â–¼</div>
    </div>

    <div class="menu">
        <button class="reset" onclick="resetGame()">RESTART</button>
    </div>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const box = 20;
    let snake, direction, nextDirection, food, score, gameLoop;

    function init() {
        snake = [{ x: 9 * box, y: 10 * box }];
        direction = "RIGHT";
        nextDirection = "RIGHT";
        score = 0;
        food = createFood();
        updateScore();
    }

    function createFood() {
        let newFood;
        while(true) {
            newFood = {
                x: Math.floor(Math.random() * 20) * box,
                y: Math.floor(Math.random() * 20) * box
            };
            let onSnake = snake.some(p => p.x === newFood.x && p.y === newFood.y);
            if (!onSnake) break;
        }
        return newFood;
    }

    function setDir(newDir) {
        if (newDir === "LEFT" && direction !== "RIGHT") nextDirection = "LEFT";
        else if (newDir === "UP" && direction !== "DOWN") nextDirection = "UP";
        else if (newDir === "RIGHT" && direction !== "LEFT") nextDirection = "RIGHT";
        else if (newDir === "DOWN" && direction !== "UP") nextDirection = "DOWN";
    }

    document.addEventListener("keydown", e => {
        if (e.key === "ArrowLeft") setDir("LEFT");
        else if (e.key === "ArrowUp") setDir("UP");
        else if (e.key === "ArrowRight") setDir("RIGHT");
        else if (e.key === "ArrowDown") setDir("DOWN");
    });

    // æ»‘å‹•æ‰‹å‹¢å„ªåŒ–
    let touchStartX = 0, touchStartY = 0;
    document.addEventListener('touchstart', e => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
    }, { passive: false });

    document.addEventListener('touchend', e => {
        let dx = e.changedTouches[0].clientX - touchStartX;
        let dy = e.changedTouches[0].clientY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
            if (Math.abs(dx) > 20) dx > 0 ? setDir("RIGHT") : setDir("LEFT");
        } else {
            if (Math.abs(dy) > 20) dy > 0 ? setDir("DOWN") : setDir("UP");
        }
    }, { passive: false });

    function draw() {
        direction = nextDirection;
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        snake.forEach((part, index) => {
            ctx.fillStyle = index === 0 ? "#2ecc71" : "#27ae60";
            ctx.fillRect(part.x, part.y, box-1, box-1);
        });

        ctx.fillStyle = "#e74c3c";
        ctx.beginPath();
        ctx.arc(food.x + box/2, food.y + box/2, box/2 - 2, 0, Math.PI*2);
        ctx.fill();

        let headX = snake[0].x;
        let headY = snake[0].y;

        if (direction === "LEFT") headX -= box;
        if (direction === "UP") headY -= box;
        if (direction === "RIGHT") headX += box;
        if (direction === "DOWN") headY += box;

        const newHead = { x: headX, y: headY };

        // ç¢°æ’æª¢æ¸¬
        if (headX < 0 || headY < 0 || headX >= canvas.width || headY >= canvas.height || 
            snake.some(p => p.x === newHead.x && p.y === newHead.y)) {
            clearInterval(gameLoop);
            setTimeout(() => {
                alert("GAME OVER! SCORE: " + score);
                resetGame();
            }, 100);
            return;
        }

        if (headX === food.x && headY === food.y) {
            score += 10;
            food = createFood();
            updateScore();
        } else {
            snake.pop();
        }

        snake.unshift(newHead);
    }

    function updateScore() {
        document.getElementById("score").innerText = "SCORE: " + score;
    }

    function resetGame() {
        clearInterval(gameLoop);
        init();
        gameLoop = setInterval(draw, 150); // ç¨å¾®æ”¾æ…¢ä¸€é»é»ï¼Œæ‰‹æ©Ÿæ¯”è¼ƒå¥½æ“ä½œ
    }

    init();
    gameLoop = setInterval(draw, 150);
</script>
</body>
</html>
