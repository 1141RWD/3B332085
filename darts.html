<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-select=none">
<title>æŠ€è¡“æµé£›é¢ - Arcade Hub</title>
<style>
    /* çµ±ä¸€å›é¦–é æŒ‰éˆ•æ¨£å¼ */
    #home-btn-container {
        position: fixed; top: 15px; left: 15px; z-index: 9999;
        display: flex; align-items: center; gap: 5px; padding: 8px 15px;
        background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 242, 254, 0.5); border-radius: 50px;
        color: #00f2fe; cursor: pointer; font-family: 'Segoe UI', sans-serif;
        font-weight: bold; font-size: 14px; box-shadow: 0 0 15px rgba(0, 242, 254, 0.2);
        transition: 0.3s; user-select: none;
    }
    #home-btn-container:hover { background: rgba(0, 242, 254, 0.2); transform: scale(1.05); }
    @media (max-width: 480px) { #home-btn-container { top: 10px; left: 10px; padding: 6px 12px; font-size: 12px; } }

    :root { --primary: #00f2ff; --accent: #f1c40f; --bonus: #2ecc71; }
    body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
    
    #ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-around; pointer-events: none; z-index: 100; }
    .stat { 
        background: rgba(15, 15, 25, 0.85); padding: 10px 20px; border-radius: 15px; 
        border: 1px solid rgba(0, 242, 255, 0.3); backdrop-filter: blur(5px); min-width: 80px; text-align: center;
    }
    .stat label { display: block; font-size: 10px; color: var(--primary); text-transform: uppercase; }
    .stat span { font-size: 20px; font-weight: bold; }

    #bonus-pop { 
        position: absolute; top: 100px; left: 50%; transform: translateX(-50%);
        font-size: 30px; font-weight: bold; color: var(--bonus); 
        text-shadow: 0 0 10px var(--bonus); opacity: 0; pointer-events: none; transition: 0.5s; z-index: 200;
    }

    /* çµç®—ç•«é¢ */
    #overlay { position: fixed; inset: 0; background: rgba(0, 0, 5, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 99999; }
    .menu-box { background: linear-gradient(145deg, #1a1a2e, #0f0f1a); padding: 40px; border-radius: 40px; text-align: center; border: 1px solid rgba(255,255,255,0.1); width: 85%; max-width: 380px; }
    .btn { padding: 18px; font-size: 18px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; margin-top: 20px; }
    .btn-next { background: linear-gradient(45deg, var(--accent), #e67e22); color: #000; }
    .btn-retry { background: #333; color: white; border: 1px solid #444; }

    canvas { display: block; }
</style>
</head>
<body>

<div id="home-btn-container" onclick="window.location.href='index.html'">
    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    <span>å¤§å»³</span>
</div>

<div id="ui">
    <div class="stat"><label>Level</label><span id="lv-txt">1</span></div>
    <div class="stat"><label>Darts</label><span id="darts-txt">ğŸ¯ğŸ¯ğŸ¯</span></div>
    <div class="stat"><label>Score</label><span id="score-txt">0</span></div>
</div>

<div id="bonus-pop">+1 DART! ğŸ¯</div>

<div id="overlay">
    <div class="menu-box">
        <h2 id="msg-title">DART MASTER</h2>
        <p id="msg-desc">æ¯å¾— 400 åˆ†å¯ç²å¾—ä¸€æ”¯çå‹µé£›é¢</p>
        <button id="action-btn" class="btn btn-next" onclick="handleAction()">é–‹å§‹éŠæˆ²</button>
    </div>
</div>

<canvas id="game"></canvas>



<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let lv = 1, score = 0, darts = 3, lastBonusScore = 0, targetScore = 500;
let isDragging = false, startPos = {x:0, y:0}, curPos = {x:0, y:0};
let gameState = "HOME", shakeAmount = 0, particles = [];
let resultTimeout = null;

const dartHome = { x: 0, y: 0 };
const target = { x: 0, y: 220, r: 110, angle: 0, baseX: 0, baseY: 220, destX: 0, destY: 0 };
const landedDarts = [];
const flyingDarts = [];

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    dartHome.x = canvas.width / 2;
    dartHome.y = canvas.height - 120;
    target.baseX = canvas.width / 2;
}
window.addEventListener('resize', resize);
resize();

function checkBonus() {
    if (score - lastBonusScore >= 400) {
        darts++; lastBonusScore += 400;
        showBonusPop(); updateUI();
    }
}

function showBonusPop() {
    const el = document.getElementById('bonus-pop');
    el.style.opacity = "1"; el.style.top = "80px";
    setTimeout(() => { el.style.opacity = "0"; el.style.top = "100px"; }, 1000);
}

function handleAction() {
    if (gameState === "RESULT" && score >= targetScore) lv++;
    startLevel();
}

function startLevel() {
    clearTimeout(resultTimeout);
    flyingDarts.length = 0; landedDarts.length = 0;
    gameState = "PLAYING";
    darts = 3; score = 0; lastBonusScore = 0;
    targetScore = 500 + (lv-1)*400;
    target.x = target.baseX; target.y = target.baseY;
    if(lv >= 3) { target.destX = target.baseX; target.destY = target.baseY; }
    document.getElementById('overlay').style.display = 'none';
    updateUI();
}

function showResult() {
    if (gameState !== "PLAYING" || flyingDarts.length > 0) return;
    gameState = "RESULT";
    document.getElementById('overlay').style.display = 'flex';
    const title = document.getElementById('msg-title');
    const desc = document.getElementById('msg-desc');
    const btn = document.getElementById('action-btn');

    if (score >= targetScore) {
        title.innerText = "æˆåŠŸæ™‰ç´šï¼";
        desc.innerText = `å¾—åˆ†ï¼š${score} / ç›®æ¨™ï¼š${targetScore}`;
        btn.innerText = "ä¸‹ä¸€é—œæŒ‘æˆ°";
        btn.className = "btn btn-next";
    } else {
        title.innerText = "æŒ‘æˆ°å¤±æ•—";
        desc.innerText = `å¾—åˆ†ï¼š${score} / éœ€è¦ï¼š${targetScore}`;
        btn.innerText = "é‡æ–°å˜—è©¦";
        btn.className = "btn btn-retry";
    }
}

// äº‹ä»¶ç›£è½
canvas.addEventListener("mousedown", startDrag);
canvas.addEventListener("mousemove", drag);
window.addEventListener("mouseup", endDrag);
canvas.addEventListener("touchstart", e => { e.preventDefault(); startDrag(e.touches[0]); });
canvas.addEventListener("touchmove", e => { e.preventDefault(); drag(e.touches[0]); });
window.addEventListener("touchend", endDrag);

function startDrag(e) {
    if (gameState !== "PLAYING" || darts <= 0) return;
    if (Math.hypot(e.clientX - dartHome.x, e.clientY - dartHome.y) < 70) {
        isDragging = true; startPos = { x: dartHome.x, y: dartHome.y }; curPos = { x: e.clientX, y: e.clientY };
    }
}
function drag(e) { if (isDragging) curPos = { x: e.clientX, y: e.clientY }; }
function endDrag() {
    if (!isDragging) return;
    isDragging = false;
    const dx = startPos.x - curPos.x, dy = startPos.y - curPos.y;
    if (Math.hypot(dx, dy) > 30) {
        darts--;
        const p = Math.min(Math.hypot(dx, dy) / 180, 1.2);
        flyingDarts.push({ x: dartHome.x, y: dartHome.y, vx: dx*0.13, vy: dy*0.13 - (p*4), scale: 1, targetY: target.y + (1-p)*45 });
        updateUI();
        if (darts === 0) {
            clearTimeout(resultTimeout);
            resultTimeout = setTimeout(() => { if (flyingDarts.length === 0) showResult(); }, 3000);
        }
    }
}

function updateUI() {
    document.getElementById('lv-txt').innerText = lv;
    document.getElementById('score-txt').innerText = score;
    document.getElementById('darts-txt').innerText = "ğŸ¯".repeat(Math.max(0, darts));
}

function draw() {
    ctx.save();
    if (shakeAmount > 0) {
        ctx.translate((Math.random()-0.5)*shakeAmount, (Math.random()-0.5)*shakeAmount);
        shakeAmount *= 0.9;
    }
    const grd = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
    grd.addColorStop(0, "#0a0a1a"); grd.addColorStop(1, "#050505");
    ctx.fillStyle = grd; ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (gameState === "PLAYING") {
        if (lv === 2) target.x = target.baseX + Math.sin(Date.now()*0.002) * 150;
        if (lv >= 3) {
            target.x += (target.destX - target.x) * 0.03; target.y += (target.destY - target.y) * 0.03;
            if (Math.hypot(target.destX-target.x, target.destY-target.y) < 10) {
                target.destX = target.baseX + (Math.random()-0.5)*300; target.destY = target.baseY + (Math.random()-0.5)*150;
            }
        }
        target.angle += 0.02;

        ctx.save(); ctx.translate(target.x, target.y); ctx.rotate(target.angle);
        const rings = [{r:110, c:'#1a1a2e', s:'#00f2ff'}, {r:85, c:'#0f0f1a', s:'#0062ff'}, {r:55, c:'#1a1a2e', s:'#00f2ff'}, {r:25, c:'#ff2e63', s:'#fff'}];
        rings.forEach(r => {
            ctx.beginPath(); ctx.arc(0, 0, r.r, 0, Math.PI*2); ctx.fillStyle = r.c; ctx.fill();
            ctx.strokeStyle = r.s; ctx.lineWidth = 3; ctx.stroke();
        });
        landedDarts.forEach(d => {
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(Math.cos(d.ang)*d.d, Math.sin(d.ang)*d.d, 6, 0, Math.PI*2); ctx.fill();
        });
        ctx.restore();

        flyingDarts.forEach((d, i) => {
            d.x += d.vx; d.y += d.vy; d.scale -= 0.015;
            ctx.fillStyle = "white"; ctx.beginPath(); ctx.ellipse(d.x, d.y, 12*d.scale, 30*d.scale, 0, 0, Math.PI*2); ctx.fill();
            if (d.scale <= 0.4 || d.y <= d.targetY) {
                const dist = Math.hypot(d.x-target.x, d.y-target.y);
                if (dist < 110) {
                    let pts = dist < 25 ? 500 : dist < 60 ? 300 : 100;
                    score += pts; shakeAmount = pts / 20;
                    createParticles(d.x, d.y, pts === 500 ? "#f1c40f" : "#00f2ff");
                    landedDarts.push({ ang: Math.atan2(d.y-target.y, d.x-target.x)-target.angle, d: dist });
                    checkBonus();
                }
                flyingDarts.splice(i, 1);
                updateUI();
                if (darts === 0 && flyingDarts.length === 0) {
                    clearTimeout(resultTimeout); resultTimeout = setTimeout(showResult, 800);
                }
            }
        });

        if (isDragging) {
            const dx = startPos.x - curPos.x, dy = startPos.y - curPos.y;
            ctx.setLineDash([8, 4]); ctx.strokeStyle = "#00f2ff"; ctx.beginPath(); ctx.moveTo(dartHome.x, dartHome.y);
            ctx.lineTo(dartHome.x + dx*2.2, dartHome.y + dy*2.2); ctx.stroke(); ctx.setLineDash([]);
        }
        ctx.fillStyle = isDragging ? "#00f2ff" : "#f1c40f";
        ctx.beginPath(); ctx.arc(dartHome.x, dartHome.y, 35, 0, Math.PI*2); ctx.fill();
    }

    for(let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i]; p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
        ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
        if (p.life <= 0) particles.splice(i, 1);
    }
    ctx.globalAlpha = 1; ctx.restore();
    requestAnimationFrame(draw);
}

function createParticles(x, y, color) {
    for (let i = 0; i < 15; i++) particles.push({ x: x, y: y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 1.0, color: color });
}

draw();
</script>
</body>
</html>
