<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éœ“è™¹è¾²å¤« - æ¥µé™å¹³è¡¡ç‰ˆ</title>
    <style>
        :root {
            --game-bg: #050510;
            --border-neon: #39ff14;
            --neon-cyan: #00f2fe;
            --zombie-color: #ff00cc;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; height: 100vh;
            background: #020205; color: white; font-family: 'Segoe UI', sans-serif;
            overflow: hidden; touch-action: none; padding-top: 50px;
        }

        /* è¿”å›å¤§å»³æŒ‰éˆ•ç¸®å° */
        #home-btn {
            position: fixed; top: 10px; left: 10px; z-index: 9999;
            padding: 5px 12px; background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--neon-cyan); border-radius: 50px;
            color: var(--neon-cyan); text-decoration: none; font-size: 12px;
            backdrop-filter: blur(5px);
        }

        /* éŠæˆ²å®¹å™¨ï¼šæ‰‹æ©Ÿç‰ˆæ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•ç¸®æ”¾ */
        #game-container {
            position: relative; 
            width: 85vw; height: 85vw; /* ä¿æŒ 1:1 */
            max-width: 400px; max-height: 400px;
            background: var(--game-bg); border: 3px solid var(--border-neon);
            box-shadow: 0 0 15px var(--border-neon); border-radius: 10px; 
            overflow: hidden;
        }

        .player, .zombie, .plant {
            position: absolute; font-size: 1.5em; width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            user-select: none; z-index: 5;
            transition: transform 0.05s linear; /* å¹³æ»‘ç§»å‹• */
        }

        #ui-panel {
            display: flex; justify-content: space-around; 
            width: 85vw; max-width: 400px;
            margin-top: 10px; padding: 8px; background: #0a0a1a; 
            border-radius: 10px; border: 1px solid rgba(57, 255, 20, 0.3);
        }
        .stat { text-align: center; }
        .stat label { display: block; font-size: 10px; color: #aaa; }
        .stat span { font-weight: bold; font-size: 14px; color: var(--border-neon); }

        /* è™›æ“¬æ‰‹æŠŠç¸®å°ï¼Œé¿å…æ¨æ“ ç•«é¢ */
        #controls {
            display: grid; grid-template-areas: ". up ." "left . right" ". down .";
            gap: 10px; margin-top: 15px; padding-bottom: 10px;
        }
        .control-btn {
            width: 50px; height: 50px; background: rgba(255,255,255,0.1);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2em; border: 1px solid rgba(255,255,255,0.2);
        }

        #overlay {
            position: fixed; inset: 0; background: rgba(0,0,5,0.9);
            display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .menu-box {
            background: #0a0a1a; padding: 20px; border-radius: 20px; text-align: center;
            border: 2px solid var(--zombie-color); width: 80%; max-width: 280px;
        }
        .btn {
            padding: 10px; border: none; border-radius: 30px;
            background: var(--border-neon); color: #000; font-weight: bold;
            width: 100%; margin-top: 10px; cursor: pointer;
        }

        @media (min-width: 768px) { #controls { display: none; } }
    </style>
</head>
<body>

<a href="index.html" id="home-btn">å¤§å»³</a>

<div id="game-container">
    <div id="player" class="player">ğŸ‘¨â€ğŸŒ¾</div>
</div>

<div id="ui-panel">
    <div class="stat"><label>é—œå¡</label><span id="level-txt">1</span></div>
    <div class="stat"><label>ç›®æ¨™</label><span id="score-txt">0 / 5</span></div>
    <div class="stat"><label>ç”Ÿå‘½</label><span>â¤ï¸</span></div>
    <div class="stat"><label>æ™‚é–“</label><span id="time-txt">60s</span></div>
</div>

<div id="controls">
    <div class="control-btn" style="grid-area: up" id="btn-up">â¬†ï¸</div>
    <div class="control-btn" style="grid-area: left" id="btn-left">â¬…ï¸</div>
    <div class="control-btn" style="grid-area: right" id="btn-right">â¡ï¸</div>
    <div class="control-btn" style="grid-area: down" id="btn-down">â¬‡ï¸</div>
</div>

<div id="overlay">
    <div class="menu-box">
        <h2 id="m-title" style="color:var(--border-neon)">éœ“è™¹è¾²å¤«</h2>
        <p id="m-text" style="font-size: 14px;">æ¡é›† ğŸŒ± ä¸¦èº²é¿ ğŸ§Ÿâ€â™€ï¸<br>æ‰‹æ©Ÿè«‹ä½¿ç”¨ä¸‹æ–¹æ–¹å‘éµ</p>
        <button id="main-btn" class="btn" onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
    </div>
</div>

<script>
    const container = document.getElementById('game-container');
    const playerEl = document.getElementById('player');
    const scoreEl = document.getElementById('score-txt');
    const timeEl = document.getElementById('time-txt');
    const levelEl = document.getElementById('level-txt');
    const overlay = document.getElementById('overlay');
    const mainBtn = document.getElementById('main-btn');

    let pX, pY, score, timeLeft, gameActive = false;
    let level = 1;
    let zombies = [], plants = [];
    let timerInterval = null;
    
    // å‹•æ…‹ç²å–å®¹å™¨å°ºå¯¸
    let containerSize = container.clientWidth;
    window.addEventListener('resize', () => {
        containerSize = container.clientWidth;
    });

    const basePlayerSpeed = 0.015; // ä½¿ç”¨ç›¸å°æ–¼å®¹å™¨å¯¬åº¦çš„æ¯”ä¾‹
    const baseZombieSpeed = 0.003;
    
    const keys = {};
    const activeMoves = {up: false, down: false, left: false, right: false};

    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function renderPlayer() {
        // ä½¿ç”¨åƒç´ ä½ç½®ç§»å‹•
        playerEl.style.left = pX + 'px';
        playerEl.style.top = pY + 'px';
    }

    function startGame() {
        overlay.style.display = 'none';
        containerSize = container.clientWidth;
        // åˆå§‹ä½ç½®è¨­ç‚ºä¸­å¿ƒ
        pX = containerSize / 2 - 15; 
        pY = containerSize / 2 - 15; 
        score = 0; timeLeft = 60;
        renderPlayer();
        
        zombies.forEach(z => z.el.remove());
        plants.forEach(p => p.el.remove());
        zombies = []; plants = [];
        
        const zombieCount = 2 + level; 
        const plantGoal = 4 + level;

        for(let i=0; i < zombieCount; i++) spawn('zombie');
        for(let i=0; i < plantGoal; i++) spawn('plant');
        
        gameActive = true;
        updateUI(plantGoal);
        requestAnimationFrame(() => loop(plantGoal));
        
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if(!gameActive) return;
            timeLeft--;
            timeEl.innerText = timeLeft + 's';
            if(timeLeft <= 0) end(false);
        }, 1000);
    }

    function spawn(type) {
        const el = document.createElement('div');
        el.className = type;
        el.innerText = type === 'zombie' ? 'ğŸ§Ÿâ€â™€ï¸' : 'ğŸŒ±';
        container.appendChild(el);
        let x, y;
        do {
            x = Math.random() * (containerSize - 30);
            y = Math.random() * (containerSize - 30);
        } while (Math.hypot(x - pX, y - pY) < 100);
        
        const obj = { el, x, y };
        if(type === 'zombie') zombies.push(obj); else plants.push(obj);
        el.style.left = x + 'px';
        el.style.top = y + 'px';
    }

    function loop(plantGoal) {
        if(!gameActive) return;

        const currentSpeed = (basePlayerSpeed + (level - 1) * 0.0005) * containerSize;
        const currentZSpeed = (baseZombieSpeed + (level - 1) * 0.0002) * containerSize;

        if(keys['w'] || keys['arrowup'] || activeMoves.up) pY -= currentSpeed;
        if(keys['s'] || keys['arrowdown'] || activeMoves.down) pY += currentSpeed;
        if(keys['a'] || keys['arrowleft'] || activeMoves.left) pX -= currentSpeed;
        if(keys['d'] || keys['arrowright'] || activeMoves.right) pX += currentSpeed;

        // é‚Šç•Œé™åˆ¶
        pX = Math.max(0, Math.min(containerSize - 30, pX));
        pY = Math.max(0, Math.min(containerSize - 30, pY));
        renderPlayer();

        zombies.forEach(z => {
            const dx = pX - z.x, dy = pY - z.y;
            const dist = Math.hypot(dx, dy);
            if(dist > 0) {
                z.x += (dx/dist) * currentZSpeed;
                z.y += (dy/dist) * currentZSpeed;
                z.el.style.left = z.x + 'px';
                z.el.style.top = z.y + 'px';
            }
            if(dist < 25) end(false);
        });

        plants.forEach((p, i) => {
            if(Math.hypot(pX - p.x, pY - p.y) < 30) {
                p.el.remove();
                plants.splice(i, 1);
                score++;
                updateUI(plantGoal);
                if(score >= plantGoal) end(true);
            }
        });

        requestAnimationFrame(() => loop(plantGoal));
    }

    function updateUI(goal) {
        scoreEl.innerText = `${score} / ${goal}`;
        levelEl.innerText = level;
    }

    function end(win) {
        gameActive = false;
        if(timerInterval) clearInterval(timerInterval);
        overlay.style.display = 'flex';
        const title = document.getElementById('m-title');
        const text = document.getElementById('m-text');
        
        if(win) {
            title.innerText = "Level " + level + " å®Œæˆï¼";
            text.innerHTML = `æˆåŠŸæ”¶æˆï¼é›£åº¦å¢åŠ ã€‚`;
            mainBtn.innerText = "é€²å…¥ä¸‹ä¸€å€‹é—œå¡";
            level++; 
        } else {
            title.innerText = "éŠæˆ²çµæŸ";
            text.innerHTML = `è¢«æ®­å±æŠ“åˆ°äº†...`;
            mainBtn.innerText = "é‡æ–°æŒ‘æˆ°ç¬¬ä¸€é—œ";
            level = 1; 
        }
    }

    function setupMobile(id, dir) {
        const btn = document.getElementById(id);
        btn.addEventListener('touchstart', (e) => { 
            e.preventDefault(); 
            activeMoves[dir] = true; 
        }, {passive: false});
        btn.addEventListener('touchend', () => activeMoves[dir] = false);
        btn.addEventListener('touchcancel', () => activeMoves[dir] = false);
    }
    setupMobile('btn-up', 'up'); setupMobile('btn-down', 'down');
    setupMobile('btn-left', 'left'); setupMobile('btn-right', 'right');
</script>
</body>
</html>
