<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>é–ƒéˆå¿«æ‰‹ - å–®äºº vs é›»è…¦AI</title>
<style>
  body {
    font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    background: #222;
    color: #eee;
    text-align: center;
    margin: 0; padding: 0;
  }
  h1 {
    margin: 20px 0 10px;
  }
  #game {
    max-width: 600px;
    margin: auto;
    background: #333;
    padding: 20px;
    border-radius: 12px;
  }
  #status {
    margin-bottom: 10px;
    font-size: 18px;
  }
  #scoreboard {
    display: flex;
    justify-content: space-around;
    margin-bottom: 10px;
    font-size: 18px;
  }
  #difficulty {
    margin-bottom: 15px;
  }
  button {
    cursor: pointer;
    background: #555;
    border: none;
    border-radius: 6px;
    color: white;
    padding: 8px 16px;
    margin: 0 5px;
    font-size: 16px;
  }
  button:hover {
    background: #777;
  }
  #cards {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 20px;
  }
  canvas.card {
    border-radius: 12px;
    background: #111;
    cursor: pointer;
    box-shadow: 0 0 8px #000;
  }
  #topicCard {
    margin: 15px auto;
    width: 150px;
    height: 150px;
    border-radius: 15px;
    background: #111;
    box-shadow: 0 0 20px #0ff;
  }
  #topicCard canvas {
    border-radius: 15px;
  }
  #message {
    margin-top: 15px;
    font-size: 20px;
    min-height: 30px;
  }
</style>
</head>
<body>
  <h1>ğŸ‘» é–ƒéˆå¿«æ‰‹ - å–®äºº vs é›»è…¦AI</h1>
  <center><h3>å­—æ¯æˆ–å­—é¡è‰²ç›¸åŒçš„å³æ˜¯ç­”æ¡ˆ</h3></center>

  <div id="game">
    <div id="difficulty">
      é›£åº¦ï¼š
      <button onclick="setDifficulty('easy')">æ–°æ‰‹</button>
      <button onclick="setDifficulty('normal')">æ­£å¸¸</button>
      <button onclick="setDifficulty('fast')">ç¥é€Ÿ</button>
      <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="scoreboard">
      <div>ç©å®¶åˆ†æ•¸: <span id="playerScore">0</span></div>
      <div>é›»è…¦åˆ†æ•¸: <span id="aiScore">0</span></div>
      <div>å›åˆ: <span id="round">0</span></div>
    </div>

    <div>
      <h3>é¡Œç›®ç‰Œ</h3>
      <div id="topicCard"></div>
    </div>

    <div id="cards"></div>

    <div id="message"></div>
  </div>

<script>
(() => {
  // ç‰Œçš„è¨­å®š
  const LETTERS = ['A', 'B', 'C', 'D', 'E'];
  // å­—é«”é¡è‰²ï¼ˆç”¨CSSé¡è‰²åï¼‰
  const FONT_COLORS = ['#FF4136', '#FF851B', '#2ECC40', '#0074D9', '#B10DC9'];
  // èƒŒæ™¯é¡è‰²
  const BG_COLORS = ['#FFDC00', '#AAAAAA', '#FF69B4', '#7FDBFF', '#39CCCC'];

  // ç›®å‰éŠæˆ²ç‹€æ…‹
  let difficulty = 'normal';
  let playerScore = 0;
  let aiScore = 0;
  let round = 0;
  let gameRunning = false;

  // ç‰Œè³‡æ–™æ ¼å¼ï¼š{letter, fontColor, bgColor}
  let topicCard = null;
  let optionCards = [];

  // é›»è…¦AIåæ‡‰æ™‚é–“ (ms)
  const AI_SPEED = {
    easy: 3000,
    normal: 1500,
    fast: 700,
  };

  // DOM å…ƒç´ 
  const topicCardDiv = document.getElementById('topicCard');
  const cardsDiv = document.getElementById('cards');
  const playerScoreSpan = document.getElementById('playerScore');
  const aiScoreSpan = document.getElementById('aiScore');
  const roundSpan = document.getElementById('round');
  const messageDiv = document.getElementById('message');

  // ç”¢ç”Ÿä¸€å¼µéš¨æ©Ÿç‰Œ
  function randomCard() {
    return {
      letter: LETTERS[Math.floor(Math.random() * LETTERS.length)],
      fontColor: FONT_COLORS[Math.floor(Math.random() * FONT_COLORS.length)],
      bgColor: BG_COLORS[Math.floor(Math.random() * BG_COLORS.length)],
    };
  }

  // ç”¨Canvasç•«ç‰Œï¼ˆ150x150ï¼‰ - å¸¶å­—æ¯ã€å­—è‰²ã€èƒŒæ™¯è‰²
  function drawCard(card, canvas) {
    const ctx = canvas.getContext('2d');
    const w = canvas.width;
    const h = canvas.height;
    ctx.clearRect(0, 0, w, h);

    // èƒŒæ™¯
    ctx.fillStyle = card.bgColor;
    ctx.fillRect(0, 0, w, h);

    // å­—æ¯
    ctx.fillStyle = card.fontColor;
    ctx.font = 'bold 100px å¾®è»Ÿæ­£é»‘é«”, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(card.letter, w / 2, h / 2);
  }

  // åˆ¤æ–·å…©å¼µç‰Œæ˜¯å¦ç¬¦åˆç­”æ¡ˆæ¢ä»¶(å­—æ¯ç›¸åŒæˆ–å­—è‰²ç›¸åŒ)
  function isAnswer(topic, card) {
    return topic.letter === card.letter || topic.fontColor === card.fontColor;
  }

  // é–‹å§‹ä¸€å›åˆ
  function newRound() {
    round++;
    roundSpan.innerText = round;
    messageDiv.innerText = '';
    topicCard = randomCard();

    // ç”¢ç”Ÿ5å¼µä¸åŒçš„é¸é …ç‰Œ
    optionCards = [];
    // ç‚ºäº†ç¢ºä¿åªæœ‰ä¸€å¼µæ˜¯ç­”æ¡ˆï¼Œå…ˆæ”¾ä¸€å¼µç­”æ¡ˆç‰Œ
    let answerCard;
    do {
      answerCard = randomCard();
    } while (!isAnswer(topicCard, answerCard));
    optionCards.push(answerCard);

    // å†ç”¢ç”Ÿ4å¼µéç­”æ¡ˆç‰Œï¼Œå­—æ¯å’Œå­—è‰²éƒ½ä¸èƒ½å’Œé¡Œç›®ç‰ŒåŒ¹é…
    while (optionCards.length < 5) {
      let c = randomCard();
      if (
        !isAnswer(topicCard, c) &&
        !optionCards.some(
          (oc) =>
            oc.letter === c.letter && oc.fontColor === c.fontColor && oc.bgColor === c.bgColor
        )
      ) {
        optionCards.push(c);
      }
    }

    // æ´—ç‰Œ (Fisherâ€“Yates shuffle)
    for (let i = optionCards.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [optionCards[i], optionCards[j]] = [optionCards[j], optionCards[i]];
    }

    render();
    waitForPlayer();
  }

  // é¡¯ç¤ºé¡Œç›®ç‰Œå’Œç‰©å“ç‰Œ
  function render() {
    // é¡Œç›®ç‰Œ
    topicCardDiv.innerHTML = '';
    let canvasTopic = document.createElement('canvas');
    canvasTopic.width = 150;
    canvasTopic.height = 150;
    drawCard(topicCard, canvasTopic);
    topicCardDiv.appendChild(canvasTopic);

    // ç‰©å“ç‰Œ
    cardsDiv.innerHTML = '';
    optionCards.forEach((c, i) => {
      let canvas = document.createElement('canvas');
      canvas.width = 100;
      canvas.height = 100;
      canvas.classList.add('card');
      drawCard(c, canvas);
      canvas.onclick = () => playerClick(i);
      cardsDiv.appendChild(canvas);
    });
  }

  // ç©å®¶é»ç‰Œäº‹ä»¶
  let playerHasClicked = false;
  function playerClick(index) {
    if (!gameRunning || playerHasClicked) return;
    playerHasClicked = true;
    const selectedCard = optionCards[index];
    if (isAnswer(topicCard, selectedCard)) {
      playerScore++;
      playerScoreSpan.innerText = playerScore;
      messageDiv.innerText = 'ğŸ‘ ä½ ç­”å°äº†ï¼';
    } else {
      playerScore = Math.max(0, playerScore - 1);
      playerScoreSpan.innerText = playerScore;
      messageDiv.innerText = 'âŒ ç­”éŒ¯äº†ï¼';
    }
    setTimeout(() => aiTurn(), 1000);
  }

  // é›»è…¦å›åˆ
  function aiTurn() {
    if (!gameRunning) return;

    messageDiv.innerText = 'ğŸ’» é›»è…¦æ€è€ƒä¸­...';
    const delay = AI_SPEED[difficulty];
    setTimeout(() => {
      // AIæ‰¾ç­”æ¡ˆç‰Œindex
      const answerIndex = optionCards.findIndex((c) => isAnswer(topicCard, c));
      // æ¨¡æ“¬AIç­”éŒ¯æ©Ÿç‡ï¼Œé›£åº¦è¶Šä½éŒ¯èª¤æ©Ÿç‡è¶Šé«˜
      let errorRate = difficulty === 'easy' ? 0.4 : difficulty === 'normal' ? 0.15 : 0.05;
      const aiCorrect = Math.random() > errorRate;
      if (aiCorrect) {
        aiScore++;
        aiScoreSpan.innerText = aiScore;
        messageDiv.innerText = `ğŸ’» é›»è…¦é¸æ“‡äº†ç‰Œ #${answerIndex + 1}ï¼Œç­”å°äº†ï¼`;
      } else {
        aiScore = Math.max(0, aiScore - 1);
        aiScoreSpan.innerText = aiScore;
        messageDiv.innerText = `ğŸ’» é›»è…¦ç­”éŒ¯äº†ï¼`;
      }
      setTimeout(() => {
        if (round >= 20) {
          endGame();
        } else {
          newRound();
        }
      }, 1500);
    }, delay);
  }

  // ç­‰å¾…ç©å®¶ç­”é¡Œæ™‚é–“ï¼ˆé™åˆ¶5ç§’ï¼‰
  let playerTimer = null;
  function waitForPlayer() {
    playerHasClicked = false;
    gameRunning = true;
    messageDiv.innerText = 'â° è«‹åœ¨5ç§’å…§é»é¸ç­”æ¡ˆç‰Œï¼';
    if (playerTimer) clearTimeout(playerTimer);
    playerTimer = setTimeout(() => {
      if (!playerHasClicked) {
        playerScore = Math.max(0, playerScore - 1);
        playerScoreSpan.innerText = playerScore;
        messageDiv.innerText = 'â³ è¶…æ™‚ï¼æ‰£1åˆ†ï¼';
        setTimeout(() => aiTurn(), 1000);
      }
    }, 5000);
  }

  // éŠæˆ²çµæŸ
  function endGame() {
    gameRunning = false;
    messageDiv.innerText = `ğŸ éŠæˆ²çµæŸï¼æœ€çµ‚åˆ†æ•¸ - ä½ ï¼š${playerScore} é›»è…¦ï¼š${aiScore}`;
  }

  // è¨­å®šé›£åº¦
  window.setDifficulty = function (level) {
    difficulty = level;
    messageDiv.innerText = `é›£åº¦è¨­å®šç‚ºï¼š${level}`;
  };

  // é–‹å§‹éŠæˆ²
  window.startGame = function () {
    playerScore = 0;
    aiScore = 0;
    round = 0;
    playerScoreSpan.innerText = playerScore;
    aiScoreSpan.innerText = aiScore;
    roundSpan.innerText = round;
    messageDiv.innerText = 'éŠæˆ²é–‹å§‹ï¼';
    newRound();
  };
})();
</script>

</body>
</html>
